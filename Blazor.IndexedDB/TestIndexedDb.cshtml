@using System.ComponentModel
@using Blazor.IndexedDB
@using Microsoft.JSInterop
<div>
    <p><b>status:</b> @Message</p>
</div>
<div class="d-flex flex-column align-items-start">
    <button class="btn btn-outline-primary " onclick="@OpenDatabase">Open Database</button>
    <button class="btn btn-outline-primary" onclick="@CreateDatabase">Create database</button>
    <div class="d-flex, flex-column">
        <div>
            <label>First Name</label> <input id="firstName" type="text" bind="@FirstName" />
        </div>
        <div>
            <label>Last Name</label> <input id="lastName" type="text" bind="@LastName" />
        </div>
        <button onclick="@TestAddRecord">Add Record</button>
    </div>


   
    
</div>

@functions
{
        string Message { get; set; }

        string FirstName { get; set; }
        string LastName { get; set; }

        private IndexedDBManager dbManager = new IndexedDBManager();

    protected async void OpenDatabase()
    {
        Message = await dbManager.OpenDb("DataStore");
        StateHasChanged();
    }

    protected async void CreateDatabase()
    {
        var dbStore = new DbStore
        {
            Name = "TestStore",
            Version = 1
        };

        var peopleTable = new TableSchema
        {
            Name = "People",
            DbVersion = 1,
            PrimaryKey = new IndexSpec
            {
                Name = "id",
                Auto = true
            }
        };

        peopleTable.Indexes.Add(new IndexSpec { Name = "lastName", KeyPath = "lastName" });
        dbStore.Tables.Add(peopleTable);


        Message = await dbManager.CreateDb2(dbStore);
        StateHasChanged();
    }

    protected async void TestAddRecord()
    {
        var person = new { FirstName,  LastName };
        var newRecord = new SingleRecord<object>
        {
            Storename = "People",
            Data = person
        };
        var result = await dbManager.AddRecord(newRecord);
        Message = $"{result.Item2} id: ${result.Item3}";
        LastName = "";
        FirstName = "";
        StateHasChanged();
    }




}
