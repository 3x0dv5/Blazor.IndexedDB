!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";!function(){function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,o){var r,i=new Promise(function(i,c){t(r=e[n].apply(e,o)).then(i,c)});return i.request=r,i}function o(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return n(this[t],r,arguments)})})}function i(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function c(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return function(e,t,o){var r=n(e,t,o);return r.then(function(e){if(e)return new u(e,r.request)})}(this[t],r,arguments)})})}function s(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function a(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function l(e){this._db=e}o(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(u,"_cursor",["direction","key","primaryKey","value"]),r(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,o),t(n._request).then(function(e){if(e)return new u(e,n._request)})})})}),a.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},a.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},o(a,"_store",["name","keyPath","indexNames","autoIncrement"]),r(a,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(a,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(a,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new a(this._tx.objectStore.apply(this._tx,arguments))},o(d,"_tx",["objectStoreNames","mode"]),i(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new a(this._db.createObjectStore.apply(this._db,arguments))},o(f,"_db",["name","version","objectStoreNames"]),i(f,"_db",IDBDatabase,["deleteObjectStore","close"]),l.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},o(l,"_db",["name","version","objectStoreNames"]),i(l,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[a,s].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=function(e){return Array.prototype.slice.call(e)}(arguments),n=t[t.length-1],o=this._store||this._index,r=o[e].apply(o,t.slice(0,-1));r.onsuccess=function(){n(r.result)}})})}),[s,a].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var p={open:function(e,t,o){var r=n(indexedDB,"open",[e,t]),i=r.request;return i&&(i.onupgradeneeded=function(e){o&&o(new f(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new l(e)})},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=p,e.exports.default=e.exports}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);var r;n(0),function(e){const t="TimeGhost",n={IndexedDbManager:new o.IndexedDbManager};e.initialise=function(){"undefined"==typeof window||window[t]?window[t]=Object.assign({},window[t],n):window[t]=Object.assign({},n)}}(r||(r={})),r.initialise()},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(c,s)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.IndexedDbManager=class{constructor(){this.isOpen=!1,this.dbPromise=new Promise((e,t)=>{}),this.openDb=(e=>{var t=e;return new Promise((e,n)=>{this.dbPromise=r.default.open(t.dbName,t.version,e=>{this.upgradeDatabase(e,t)}),e("database created")})}),this.addRecordAsync=(e=>o(this,void 0,void 0,function*(){const t=e.storename,n=e.data,o=(yield this.dbPromise).transaction(t,"readwrite");let r;try{r=`Added new record with id ${yield o.objectStore(t).add(n)}`}catch(e){console.log("Error adding recording:",e.message),r="Failed to add new record"}return r})),this.updateRecord=(e=>o(this,void 0,void 0,function*(){const t=e.storename,n=e.data,o=(yield this.dbPromise).transaction(t,"readwrite");let r;try{r=`updated record with id ${yield o.objectStore(t).put(n)}`}catch(e){console.log("Error adding recording:",e.message),r="Failed to update record"}return r})),this.getRecords=(e=>o(this,void 0,void 0,function*(){const t=yield this.dbPromise;let n;try{let o=yield t.transaction(e).objectStore(e).getAll();n=JSON.stringify(o)}catch(e){console.error("Issue getting all records",e),n="failed to get records"}return n})),this.getRecordById=(e=>new Promise((t,n)=>{const o=e.storename,r=e.data;this.dbPromise.then(e=>e.transaction(o,"readonly").objectStore(o).get(r)).then(e=>{var n=JSON.stringify(e);t(n)}).catch(e=>{console.error(`failed to get record: ${r}`,e),n(`failed to get record: ${r}`)})}))}upgradeDatabase(e,t){if(e.oldVersion<t.version&&t.stores)for(let n=0;n<t.stores.length;n++){const o=t.stores[n];if(!e.objectStoreNames.contains(o.name)){let t=o.primaryKey;t||(t={name:"id",keyPath:"id",auto:!0});const n=e.createObjectStore(o.name,{keyPath:t.name,autoIncrement:t.auto});for(let e=0;e<o.indexes.length;e++){const t=o.indexes[e];n.createIndex(t.name,t.keyPath,{unique:t.unique})}}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9saWIvaWRiLmpzIiwid2VicGFjazovLy8uL3NyYy9Jbml0aWFsaXNlSW5kZXhEYkJsYXpvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXhlZERiQmxhem9yLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwidGhpcyIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJDdXJzb3IiLCJwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCIsIkluZGV4IiwiaW5kZXgiLCJfaW5kZXgiLCJjdXJzb3IiLCJfY3Vyc29yIiwiX3JlcXVlc3QiLCJPYmplY3RTdG9yZSIsInN0b3JlIiwiX3N0b3JlIiwiVHJhbnNhY3Rpb24iLCJpZGJUcmFuc2FjdGlvbiIsIl90eCIsImNvbXBsZXRlIiwib25jb21wbGV0ZSIsIm9uYWJvcnQiLCJVcGdyYWRlREIiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsIkRCIiwiSURCSW5kZXgiLCJJREJDdXJzb3IiLCJtZXRob2ROYW1lIiwiY3JlYXRlSW5kZXgiLCJJREJPYmplY3RTdG9yZSIsIm9iamVjdFN0b3JlIiwiSURCVHJhbnNhY3Rpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsIklEQkRhdGFiYXNlIiwiZnVuY05hbWUiLCJyZXBsYWNlIiwiYXJyIiwiQXJyYXkiLCJzbGljZSIsInRvQXJyYXkiLCJjYWxsYmFjayIsImxlbmd0aCIsIm5hdGl2ZU9iamVjdCIsImdldEFsbCIsInF1ZXJ5IiwiY291bnQiLCJpbnN0YW5jZSIsIml0ZW1zIiwiaXRlcmF0ZUN1cnNvciIsInB1c2giLCJ1bmRlZmluZWQiLCJjb250aW51ZSIsImV4cCIsIm9wZW4iLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJkZWZhdWx0IiwiaW5kZXhlZERiQmxhem9yXzEiLCJJbmRleERiIiwidGltZWdob3N0RXh0ZW5zaW9ucyIsImV4dGVuc2lvbk9iamVjdCIsIkluZGV4ZWREYk1hbmFnZXIiLCJpbml0aWFsaXNlIiwid2luZG93IiwiYXNzaWduIiwiaWRiXzEiLCJbb2JqZWN0IE9iamVjdF0iLCJpc09wZW4iLCJkYlByb21pc2UiLCJvcGVuRGIiLCJkYXRhIiwiZGJTdG9yZSIsImRiTmFtZSIsInVwZ3JhZGVEQiIsInVwZ3JhZGVEYXRhYmFzZSIsImFkZFJlY29yZEFzeW5jIiwicmVjb3JkIiwiX19hd2FpdGVyIiwic3ROYW1lIiwic3RvcmVuYW1lIiwiaXRlbVRvU2F2ZSIsInR4IiwicmV0dXJuVmFsdWUiLCJhZGQiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwibWVzc2FnZSIsInVwZGF0ZVJlY29yZCIsInB1dCIsImdldFJlY29yZHMiLCJzdG9yZU5hbWUiLCJkYkluc3RhbmNlIiwicmVzdWx0cyIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRSZWNvcmRCeUlkIiwiaWQiLCJqc29uIiwiY2F0Y2giLCJzdG9yZXMiLCJzdG9yZVNjaGVtYSIsIm9iamVjdFN0b3JlTmFtZXMiLCJjb250YWlucyIsInByaW1hcnlLZXkiLCJrZXlQYXRoIiwiYXV0byIsImF1dG9JbmNyZW1lbnQiLCJqIiwiaW5kZXhlcyIsInVuaXF1ZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxhQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFB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IiwiZmlsZSI6ImluZGV4ZWREYi5CbGF6b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgaWYgKENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwpIHJldHVybjtcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uKGN1cnNvcikge1xuICAgICAgICAgIGlmICghY3Vyc29yKSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsImltcG9ydCB7IEluZGV4ZWREYk1hbmFnZXIgfSBmcm9tICcuL2luZGV4ZWREYkJsYXpvcic7XHJcbmltcG9ydCAnaWRiJztcclxuXHJcbm5hbWVzcGFjZSBJbmRleERiIHtcclxuICAgIGNvbnN0IHRpbWVnaG9zdEV4dGVuc2lvbnM6IHN0cmluZyA9ICdUaW1lR2hvc3QnO1xyXG4gICAgY29uc3QgZXh0ZW5zaW9uT2JqZWN0ID0ge1xyXG4gICAgICAgIEluZGV4ZWREYk1hbmFnZXI6IG5ldyBJbmRleGVkRGJNYW5hZ2VyKClcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpc2UoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICF3aW5kb3dbdGltZWdob3N0RXh0ZW5zaW9uc10pIHtcclxuICAgICAgICAgICAgd2luZG93W3RpbWVnaG9zdEV4dGVuc2lvbnNdID0ge1xyXG4gICAgICAgICAgICAgICAgLi4uZXh0ZW5zaW9uT2JqZWN0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgd2luZG93W3RpbWVnaG9zdEV4dGVuc2lvbnNdID0ge1xyXG4gICAgICAgICAgICAgICAgLi4ud2luZG93W3RpbWVnaG9zdEV4dGVuc2lvbnNdLFxyXG4gICAgICAgICAgICAgICAgLi4uZXh0ZW5zaW9uT2JqZWN0XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufVxyXG5cclxuSW5kZXhEYi5pbml0aWFsaXNlKCk7IiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIk1pY3Jvc29mdC5KU0ludGVyb3AuZC50c1wiLz5cclxuaW1wb3J0IGlkYiwgeyBUcmFuc2FjdGlvbiB9IGZyb20gJ2lkYic7XHJcbmltcG9ydCB7IERCLCBVcGdyYWRlREIgfSBmcm9tICdpZGInO1xyXG5cclxuXHJcbmludGVyZmFjZSBJU3RvcmVSZWNvcmQge1xyXG4gICAgc3RvcmVuYW1lOiBzdHJpbmc7XHJcbiAgICBkYXRhOiBvYmplY3Q7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJSW5kZXhTcGVjIHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGtleVBhdGg6IHN0cmluZztcclxuICAgIHVuaXF1ZT86IGJvb2xlYW47XHJcbiAgICBhdXRvOiBib29sZWFuO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSVN0b3JlU2NoZW1hIHtcclxuICAgIGRiVmVyc2lvbj86IG51bWJlcjtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHByaW1hcnlLZXk6IElJbmRleFNwZWM7XHJcbiAgICBpbmRleGVzOiBJSW5kZXhTcGVjW107XHJcbn1cclxuXHJcbmludGVyZmFjZSBJRGJTdG9yZSB7XHJcbiAgICBkYk5hbWU6IHN0cmluZztcclxuICAgIHZlcnNpb246IG51bWJlcjtcclxuICAgIHN0b3JlczogSVN0b3JlU2NoZW1hW107XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSW5kZXhlZERiTWFuYWdlciB7XHJcbiAgICBwcml2YXRlIGlzT3BlbiA9IGZhbHNlO1xyXG4gICAgcHJpdmF0ZSBkYlByb21pc2U6IFByb21pc2U8REI+ID0gbmV3IFByb21pc2U8REI+KChyZXNvbHZlLCByZWplY3QpID0+IHsgfSk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICAgIHB1YmxpYyBvcGVuRGIgPSAoZGF0YSk6IFByb21pc2U8c3RyaW5nPiA9PiB7XHJcbiAgICAgICAgdmFyIGRiU3RvcmUgPSBkYXRhIGFzIElEYlN0b3JlO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5kYlByb21pc2UgPSBpZGIub3BlbihkYlN0b3JlLmRiTmFtZSwgZGJTdG9yZS52ZXJzaW9uLCB1cGdyYWRlREIgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGdyYWRlRGF0YWJhc2UodXBncmFkZURCLCBkYlN0b3JlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXNvbHZlKCdkYXRhYmFzZSBjcmVhdGVkJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZFJlY29yZEFzeW5jID0gYXN5bmMgKHJlY29yZDogSVN0b3JlUmVjb3JkKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgICAgICBjb25zdCBzdE5hbWUgPSByZWNvcmQuc3RvcmVuYW1lO1xyXG4gICAgICAgIGNvbnN0IGl0ZW1Ub1NhdmUgPSByZWNvcmQuZGF0YTtcclxuICAgICAgICBjb25zdCBkYkluc3RhbmNlID0gYXdhaXQgdGhpcy5kYlByb21pc2U7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYkluc3RhbmNlLnRyYW5zYWN0aW9uKHN0TmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0eC5vYmplY3RTdG9yZShzdE5hbWUpLmFkZChpdGVtVG9TYXZlKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBgQWRkZWQgbmV3IHJlY29yZCB3aXRoIGlkICR7cmVzdWx0fWA7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgYWRkaW5nIHJlY29yZGluZzpcIiwgZXJyLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgIHJldHVyblZhbHVlID0gJ0ZhaWxlZCB0byBhZGQgbmV3IHJlY29yZCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgdXBkYXRlUmVjb3JkID0gYXN5bmMgKHJlY29yZDogSVN0b3JlUmVjb3JkKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgICAgICBjb25zdCBzdE5hbWUgPSByZWNvcmQuc3RvcmVuYW1lO1xyXG4gICAgICAgIGNvbnN0IGl0ZW1Ub1NhdmUgPSByZWNvcmQuZGF0YTtcclxuICAgICAgICBjb25zdCBkYkluc3RhbmNlID0gYXdhaXQgdGhpcy5kYlByb21pc2U7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYkluc3RhbmNlLnRyYW5zYWN0aW9uKHN0TmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0eC5vYmplY3RTdG9yZShzdE5hbWUpLnB1dChpdGVtVG9TYXZlKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBgdXBkYXRlZCByZWNvcmQgd2l0aCBpZCAke3Jlc3VsdH1gO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIGFkZGluZyByZWNvcmRpbmc6XCIsIGVyci5tZXNzYWdlKVxyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9ICdGYWlsZWQgdG8gdXBkYXRlIHJlY29yZCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFJlY29yZHMgPSBhc3luYyAoc3RvcmVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgICAgIGNvbnN0IGRiSW5zdGFuY2UgPSBhd2FpdCB0aGlzLmRiUHJvbWlzZTtcclxuICAgICAgICBsZXQgcmV0dXJuVmFsdWU6IHN0cmluZztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCBkYkluc3RhbmNlLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSkub2JqZWN0U3RvcmUoc3RvcmVOYW1lKS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBKU09OLnN0cmluZ2lmeShyZXN1bHRzKTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIklzc3VlIGdldHRpbmcgYWxsIHJlY29yZHNcIiwgZXJyKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBcImZhaWxlZCB0byBnZXQgcmVjb3Jkc1wiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZWNvcmRCeUlkID0gKGRhdGE6IElTdG9yZVJlY29yZCk6IFByb21pc2U8c3RyaW5nPiA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdG9yZU5hbWUgPSBkYXRhLnN0b3JlbmFtZTtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgXCJyZWFkb25seVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZShzdG9yZU5hbWUpLmdldChpZCk7XHJcbiAgICAgICAgICAgIH0pLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoanNvbik7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYGZhaWxlZCB0byBnZXQgcmVjb3JkOiAke2lkfWAsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChgZmFpbGVkIHRvIGdldCByZWNvcmQ6ICR7aWR9YCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuIFxyXG4gICAgcHJpdmF0ZSB1cGdyYWRlRGF0YWJhc2UodXBncmFkZURCOiBVcGdyYWRlREIsIGRiU3RvcmU6IElEYlN0b3JlKSB7XHJcbiAgICAgICAgaWYgKHVwZ3JhZGVEQi5vbGRWZXJzaW9uIDwgZGJTdG9yZS52ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgIGlmIChkYlN0b3JlLnN0b3Jlcykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYlN0b3JlLnN0b3Jlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlU2NoZW1hID0gZGJTdG9yZS5zdG9yZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1cGdyYWRlREIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhzdG9yZVNjaGVtYS5uYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJpbWFyeUtleSA9IHN0b3JlU2NoZW1hLnByaW1hcnlLZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJpbWFyeUtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUtleSA9IHsgbmFtZTogJ2lkJywga2V5UGF0aDogJ2lkJywgYXV0bzogdHJ1ZSB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlU2NoZW1hLm5hbWUsIHsga2V5UGF0aDogcHJpbWFyeUtleS5uYW1lLCBhdXRvSW5jcmVtZW50OiBwcmltYXJ5S2V5LmF1dG8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc3RvcmVTY2hlbWEuaW5kZXhlcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBzdG9yZVNjaGVtYS5pbmRleGVzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoaW5kZXgubmFtZSwgaW5kZXgua2V5UGF0aCwgeyB1bmlxdWU6IGluZGV4LnVuaXF1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiIn0=