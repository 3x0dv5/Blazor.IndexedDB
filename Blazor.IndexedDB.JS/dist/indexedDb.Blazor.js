!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";!function(){function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,o){var r,i=new Promise(function(i,c){t(r=e[n].apply(e,o)).then(i,c)});return i.request=r,i}function o(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return n(this[t],r,arguments)})})}function i(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function c(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return function(e,t,o){var r=n(e,t,o);return r.then(function(e){if(e)return new u(e,r.request)})}(this[t],r,arguments)})})}function s(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function a(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function f(e){this._db=e}o(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(u,"_cursor",["direction","key","primaryKey","value"]),r(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,o),t(n._request).then(function(e){if(e)return new u(e,n._request)})})})}),a.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},a.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},o(a,"_store",["name","keyPath","indexNames","autoIncrement"]),r(a,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(a,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(a,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new a(this._tx.objectStore.apply(this._tx,arguments))},o(d,"_tx",["objectStoreNames","mode"]),i(d,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new a(this._db.createObjectStore.apply(this._db,arguments))},o(l,"_db",["name","version","objectStoreNames"]),i(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},o(f,"_db",["name","version","objectStoreNames"]),i(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[a,s].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=function(e){return Array.prototype.slice.call(e)}(arguments),n=t[t.length-1],o=this._store||this._index,r=o[e].apply(o,t.slice(0,-1));r.onsuccess=function(){n(r.result)}})})}),[s,a].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var p={open:function(e,t,o){var r=n(indexedDB,"open",[e,t]),i=r.request;return i&&(i.onupgradeneeded=function(e){o&&o(new l(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new f(e)})},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=p,e.exports.default=e.exports}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);var r;n(0),function(e){const t="TimeGhost",n={IndexedDbManager:new o.IndexedDbManager};e.initialise=function(){"undefined"==typeof window||window[t]?window[t]=Object.assign({},window[t],n):window[t]=Object.assign({},n)}}(r||(r={})),r.initialise()},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(c,s)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.IndexedDbManager=class{constructor(){this.isOpen=!1,this.dbPromise=new Promise((e,t)=>{}),this.openDb=(e=>{var t=e;return new Promise((e,n)=>{this.dbPromise=r.default.open(t.dbName,t.version,e=>{this.upgradeDatabase(e,t)}),e("database created")})}),this.addRecord=(e=>o(this,void 0,void 0,function*(){const t=e.storename,n=e.data,o=(yield this.dbPromise).transaction(t,"readwrite");let r;try{r=`Added new record with id ${yield o.objectStore(t).add(n)}`}catch(e){console.log("Error adding recording:",e.message),r="Failed to add new record"}return r})),this.updateRecord=(e=>o(this,void 0,void 0,function*(){const t=e.storename,n=e.data,o=(yield this.dbPromise).transaction(t,"readwrite");let r;try{r=`updated record with id ${yield o.objectStore(t).put(n)}`}catch(e){console.log("Error adding recording:",e.message),r="Failed to update record"}return r})),this.getRecords=(e=>o(this,void 0,void 0,function*(){const t=yield this.dbPromise;let n;try{let o=yield t.transaction(e).objectStore(e).getAll();n=JSON.stringify(o)}catch(e){console.error("Issue getting all records",e),n="failed to get records"}return n})),this.getRecordById=(e=>o(this,void 0,void 0,function*(){const t=e.storename,n=e.data,o=yield this.dbPromise;let r;try{let e=yield o.transaction(t,"readonly").objectStore(t).get(n);r=JSON.stringify(e)}catch(e){console.error(`failed to get record: ${n}`,e),r=`failed to get record: ${n}`}return r})),this.deleteRecord=(e=>o(this,void 0,void 0,function*(){const t=e.storename,n=e.data,o=(yield this.dbPromise).transaction(t,"readwrite");try{return yield o.objectStore(t).delete(n),yield o.complete,"Record deleted"}catch(e){return console.error("failed to delete record",e),"Failed to delete record"}}))}upgradeDatabase(e,t){if(e.oldVersion<t.version&&t.stores)for(let n=0;n<t.stores.length;n++){const o=t.stores[n];if(!e.objectStoreNames.contains(o.name)){let t=o.primaryKey;t||(t={name:"id",keyPath:"id",auto:!0});const n=e.createObjectStore(o.name,{keyPath:t.name,autoIncrement:t.auto});for(let e=0;e<o.indexes.length;e++){const t=o.indexes[e];n.createIndex(t.name,t.keyPath,{unique:t.unique})}}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9saWIvaWRiLmpzIiwid2VicGFjazovLy8uL3NyYy9Jbml0aWFsaXNlSW5kZXhEYkJsYXpvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXhlZERiQmxhem9yLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwidGhpcyIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJDdXJzb3IiLCJwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCIsIkluZGV4IiwiaW5kZXgiLCJfaW5kZXgiLCJjdXJzb3IiLCJfY3Vyc29yIiwiX3JlcXVlc3QiLCJPYmplY3RTdG9yZSIsInN0b3JlIiwiX3N0b3JlIiwiVHJhbnNhY3Rpb24iLCJpZGJUcmFuc2FjdGlvbiIsIl90eCIsImNvbXBsZXRlIiwib25jb21wbGV0ZSIsIm9uYWJvcnQiLCJVcGdyYWRlREIiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsIkRCIiwiSURCSW5kZXgiLCJJREJDdXJzb3IiLCJtZXRob2ROYW1lIiwiY3JlYXRlSW5kZXgiLCJJREJPYmplY3RTdG9yZSIsIm9iamVjdFN0b3JlIiwiSURCVHJhbnNhY3Rpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsIklEQkRhdGFiYXNlIiwiZnVuY05hbWUiLCJyZXBsYWNlIiwiYXJyIiwiQXJyYXkiLCJzbGljZSIsInRvQXJyYXkiLCJjYWxsYmFjayIsImxlbmd0aCIsIm5hdGl2ZU9iamVjdCIsImdldEFsbCIsInF1ZXJ5IiwiY291bnQiLCJpbnN0YW5jZSIsIml0ZW1zIiwiaXRlcmF0ZUN1cnNvciIsInB1c2giLCJ1bmRlZmluZWQiLCJjb250aW51ZSIsImV4cCIsIm9wZW4iLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJkZWZhdWx0IiwiaW5kZXhlZERiQmxhem9yXzEiLCJJbmRleERiIiwidGltZWdob3N0RXh0ZW5zaW9ucyIsImV4dGVuc2lvbk9iamVjdCIsIkluZGV4ZWREYk1hbmFnZXIiLCJpbml0aWFsaXNlIiwid2luZG93IiwiYXNzaWduIiwiaWRiXzEiLCJbb2JqZWN0IE9iamVjdF0iLCJpc09wZW4iLCJkYlByb21pc2UiLCJvcGVuRGIiLCJkYXRhIiwiZGJTdG9yZSIsImRiTmFtZSIsInVwZ3JhZGVEQiIsInVwZ3JhZGVEYXRhYmFzZSIsImFkZFJlY29yZCIsInJlY29yZCIsIl9fYXdhaXRlciIsInN0TmFtZSIsInN0b3JlbmFtZSIsIml0ZW1Ub1NhdmUiLCJ0eCIsInJldHVyblZhbHVlIiwiYWRkIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJ1cGRhdGVSZWNvcmQiLCJwdXQiLCJnZXRSZWNvcmRzIiwic3RvcmVOYW1lIiwiZGJJbnN0YW5jZSIsInJlc3VsdHMiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0UmVjb3JkQnlJZCIsImlkIiwiZGVsZXRlUmVjb3JkIiwic3RvcmVzIiwic3RvcmVTY2hlbWEiLCJvYmplY3RTdG9yZU5hbWVzIiwiY29udGFpbnMiLCJwcmltYXJ5S2V5Iiwia2V5UGF0aCIsImF1dG8iLCJhdXRvSW5jcmVtZW50IiwiaiIsImluZGV4ZXMiLCJ1bmlxdWUiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxHQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsYUFBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FB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RXBELE1BQU1sRyxFQUFRa0UsRUFBVTdDLGtCQUFrQndFLEVBQVk1SixNQUFRZ0ssUUFBU0QsRUFBVy9KLEtBQU1rSyxjQUFlSCxFQUFXRSxPQUNsSCxJQUFLLElBQUlFLEVBQUksRUFBR0EsRUFBSVAsRUFBWVEsUUFBUXZFLE9BQVFzRSxJQUFLLENBQ2pELE1BQU0xRyxFQUFRbUcsRUFBWVEsUUFBUUQsR0FDbENwRyxFQUFNaUIsWUFBWXZCLEVBQU16RCxLQUFNeUQsRUFBTXVHLFNBQVdLLE9BQVE1RyxFQUFNNEciLCJmaWxlIjoiaW5kZXhlZERiLkJsYXpvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIiwiaW1wb3J0IHsgSW5kZXhlZERiTWFuYWdlciB9IGZyb20gJy4vaW5kZXhlZERiQmxhem9yJztcclxuaW1wb3J0ICdpZGInO1xyXG5cclxubmFtZXNwYWNlIEluZGV4RGIge1xyXG4gICAgY29uc3QgdGltZWdob3N0RXh0ZW5zaW9uczogc3RyaW5nID0gJ1RpbWVHaG9zdCc7XHJcbiAgICBjb25zdCBleHRlbnNpb25PYmplY3QgPSB7XHJcbiAgICAgICAgSW5kZXhlZERiTWFuYWdlcjogbmV3IEluZGV4ZWREYk1hbmFnZXIoKVxyXG4gICAgfTtcclxuXHJcbiAgICBleHBvcnQgZnVuY3Rpb24gaW5pdGlhbGlzZSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgIXdpbmRvd1t0aW1lZ2hvc3RFeHRlbnNpb25zXSkge1xyXG4gICAgICAgICAgICB3aW5kb3dbdGltZWdob3N0RXh0ZW5zaW9uc10gPSB7XHJcbiAgICAgICAgICAgICAgICAuLi5leHRlbnNpb25PYmplY3RcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB3aW5kb3dbdGltZWdob3N0RXh0ZW5zaW9uc10gPSB7XHJcbiAgICAgICAgICAgICAgICAuLi53aW5kb3dbdGltZWdob3N0RXh0ZW5zaW9uc10sXHJcbiAgICAgICAgICAgICAgICAuLi5leHRlbnNpb25PYmplY3RcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG5JbmRleERiLmluaXRpYWxpc2UoKTsiLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiTWljcm9zb2Z0LkpTSW50ZXJvcC5kLnRzXCIvPlxyXG5pbXBvcnQgaWRiLCB7IFRyYW5zYWN0aW9uIH0gZnJvbSAnaWRiJztcclxuaW1wb3J0IHsgREIsIFVwZ3JhZGVEQiB9IGZyb20gJ2lkYic7XHJcblxyXG5cclxuaW50ZXJmYWNlIElTdG9yZVJlY29yZCB7XHJcbiAgICBzdG9yZW5hbWU6IHN0cmluZztcclxuICAgIGRhdGE6IGFueTtcclxufVxyXG5cclxuaW50ZXJmYWNlIElJbmRleFNwZWMge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAga2V5UGF0aDogc3RyaW5nO1xyXG4gICAgdW5pcXVlPzogYm9vbGVhbjtcclxuICAgIGF1dG86IGJvb2xlYW47XHJcbn1cclxuXHJcbmludGVyZmFjZSBJU3RvcmVTY2hlbWEge1xyXG4gICAgZGJWZXJzaW9uPzogbnVtYmVyO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgcHJpbWFyeUtleTogSUluZGV4U3BlYztcclxuICAgIGluZGV4ZXM6IElJbmRleFNwZWNbXTtcclxufVxyXG5cclxuaW50ZXJmYWNlIElEYlN0b3JlIHtcclxuICAgIGRiTmFtZTogc3RyaW5nO1xyXG4gICAgdmVyc2lvbjogbnVtYmVyO1xyXG4gICAgc3RvcmVzOiBJU3RvcmVTY2hlbWFbXTtcclxuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJbmRleGVkRGJNYW5hZ2VyIHtcclxuICAgIHByaXZhdGUgaXNPcGVuID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGRiUHJvbWlzZTogUHJvbWlzZTxEQj4gPSBuZXcgUHJvbWlzZTxEQj4oKHJlc29sdmUsIHJlamVjdCkgPT4geyB9KTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHt9XHJcblxyXG4gICAgcHVibGljIG9wZW5EYiA9IChkYXRhKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgICAgICB2YXIgZGJTdG9yZSA9IGRhdGEgYXMgSURiU3RvcmU7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmRiUHJvbWlzZSA9IGlkYi5vcGVuKGRiU3RvcmUuZGJOYW1lLCBkYlN0b3JlLnZlcnNpb24sIHVwZ3JhZGVEQiA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZ3JhZGVEYXRhYmFzZSh1cGdyYWRlREIsIGRiU3RvcmUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoJ2RhdGFiYXNlIGNyZWF0ZWQnKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkUmVjb3JkID0gYXN5bmMgKHJlY29yZDogSVN0b3JlUmVjb3JkKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgICAgICBjb25zdCBzdE5hbWUgPSByZWNvcmQuc3RvcmVuYW1lO1xyXG4gICAgICAgIGNvbnN0IGl0ZW1Ub1NhdmUgPSByZWNvcmQuZGF0YTtcclxuICAgICAgICBjb25zdCBkYkluc3RhbmNlID0gYXdhaXQgdGhpcy5kYlByb21pc2U7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYkluc3RhbmNlLnRyYW5zYWN0aW9uKHN0TmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0eC5vYmplY3RTdG9yZShzdE5hbWUpLmFkZChpdGVtVG9TYXZlKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBgQWRkZWQgbmV3IHJlY29yZCB3aXRoIGlkICR7cmVzdWx0fWA7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgYWRkaW5nIHJlY29yZGluZzpcIiwgZXJyLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgIHJldHVyblZhbHVlID0gJ0ZhaWxlZCB0byBhZGQgbmV3IHJlY29yZCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgdXBkYXRlUmVjb3JkID0gYXN5bmMgKHJlY29yZDogSVN0b3JlUmVjb3JkKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgICAgICBjb25zdCBzdE5hbWUgPSByZWNvcmQuc3RvcmVuYW1lO1xyXG4gICAgICAgIGNvbnN0IGl0ZW1Ub1NhdmUgPSByZWNvcmQuZGF0YTtcclxuICAgICAgICBjb25zdCBkYkluc3RhbmNlID0gYXdhaXQgdGhpcy5kYlByb21pc2U7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYkluc3RhbmNlLnRyYW5zYWN0aW9uKHN0TmFtZSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0eC5vYmplY3RTdG9yZShzdE5hbWUpLnB1dChpdGVtVG9TYXZlKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBgdXBkYXRlZCByZWNvcmQgd2l0aCBpZCAke3Jlc3VsdH1gO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIGFkZGluZyByZWNvcmRpbmc6XCIsIGVyci5tZXNzYWdlKVxyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9ICdGYWlsZWQgdG8gdXBkYXRlIHJlY29yZCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFJlY29yZHMgPSBhc3luYyAoc3RvcmVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgICAgIGNvbnN0IGRiSW5zdGFuY2UgPSBhd2FpdCB0aGlzLmRiUHJvbWlzZTtcclxuICAgICAgICBsZXQgcmV0dXJuVmFsdWU6IHN0cmluZztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgbGV0IHJlc3VsdHMgPSBhd2FpdCBkYkluc3RhbmNlLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSkub2JqZWN0U3RvcmUoc3RvcmVOYW1lKS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBKU09OLnN0cmluZ2lmeShyZXN1bHRzKTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIklzc3VlIGdldHRpbmcgYWxsIHJlY29yZHNcIiwgZXJyKTtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBcImZhaWxlZCB0byBnZXQgcmVjb3Jkc1wiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZWNvcmRCeUlkID0gYXN5bmMgKGRhdGE6IElTdG9yZVJlY29yZCk6IFByb21pc2U8c3RyaW5nPiA9PiB7XHJcbiAgICAgICAgY29uc3Qgc3RvcmVOYW1lID0gZGF0YS5zdG9yZW5hbWU7XHJcbiAgICAgICAgY29uc3QgaWQgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgY29uc3QgZGJJbnN0YW5jZSA9IGF3YWl0IHRoaXMuZGJQcm9taXNlO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgZGJJbnN0YW5jZS50cmFuc2FjdGlvbihzdG9yZU5hbWUsICdyZWFkb25seScpXHJcbiAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoc3RvcmVOYW1lKS5nZXQoaWQpO1xyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYGZhaWxlZCB0byBnZXQgcmVjb3JkOiAke2lkfWAsIGVycik7XHJcbiAgICAgICAgICAgIHJldHVyblZhbHVlID0gYGZhaWxlZCB0byBnZXQgcmVjb3JkOiAke2lkfWA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRlbGV0ZVJlY29yZCA9IGFzeW5jIChkYXRhOiBJU3RvcmVSZWNvcmQpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0b3JlTmFtZSA9IGRhdGEuc3RvcmVuYW1lO1xyXG4gICAgICAgIGNvbnN0IGlkID0gZGF0YS5kYXRhO1xyXG4gICAgICAgIGNvbnN0IGRiSW5zdGFuY2UgPSBhd2FpdCB0aGlzLmRiUHJvbWlzZTtcclxuICAgICAgICBjb25zdCB0eCA9IGRiSW5zdGFuY2UudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCAncmVhZHdyaXRlJyk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHR4Lm9iamVjdFN0b3JlKHN0b3JlTmFtZSkuZGVsZXRlKGlkKTsgXHJcbiAgICAgICAgICAgIGF3YWl0IHR4LmNvbXBsZXRlO1xyXG4gICAgICAgICAgICByZXR1cm4gJ1JlY29yZCBkZWxldGVkJztcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignZmFpbGVkIHRvIGRlbGV0ZSByZWNvcmQnLCBlcnIpO1xyXG4gICAgICAgICAgICByZXR1cm4gJ0ZhaWxlZCB0byBkZWxldGUgcmVjb3JkJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gXHJcbiAgICBwcml2YXRlIHVwZ3JhZGVEYXRhYmFzZSh1cGdyYWRlREI6IFVwZ3JhZGVEQiwgZGJTdG9yZTogSURiU3RvcmUpIHtcclxuICAgICAgICBpZiAodXBncmFkZURCLm9sZFZlcnNpb24gPCBkYlN0b3JlLnZlcnNpb24pIHtcclxuICAgICAgICAgICAgaWYgKGRiU3RvcmUuc3RvcmVzKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRiU3RvcmUuc3RvcmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmVTY2hlbWEgPSBkYlN0b3JlLnN0b3Jlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXVwZ3JhZGVEQi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHN0b3JlU2NoZW1hLm5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmltYXJ5S2V5ID0gc3RvcmVTY2hlbWEucHJpbWFyeUtleTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmltYXJ5S2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5S2V5ID0geyBuYW1lOiAnaWQnLCBrZXlQYXRoOiAnaWQnLCBhdXRvOiB0cnVlIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoc3RvcmVTY2hlbWEubmFtZSwgeyBrZXlQYXRoOiBwcmltYXJ5S2V5Lm5hbWUsIGF1dG9JbmNyZW1lbnQ6IHByaW1hcnlLZXkuYXV0byB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzdG9yZVNjaGVtYS5pbmRleGVzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHN0b3JlU2NoZW1hLmluZGV4ZXNbal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5jcmVhdGVJbmRleChpbmRleC5uYW1lLCBpbmRleC5rZXlQYXRoLCB7IHVuaXF1ZTogaW5kZXgudW5pcXVlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il0sInNvdXJjZVJvb3QiOiIifQ==