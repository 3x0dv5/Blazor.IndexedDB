!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";!function(){function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,o){var r,i=new Promise(function(i,s){t(r=e[n].apply(e,o)).then(i,s)});return i.request=r,i}function o(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return n(this[t],r,arguments)})})}function i(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function s(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return function(e,t,o){var r=n(e,t,o);return r.then(function(e){if(e)return new a(e,r.request)})}(this[t],r,arguments)})})}function c(e){this._index=e}function a(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function l(e){this._db=e}o(c,"_index",["name","keyPath","multiEntry","unique"]),r(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(a,"_cursor",["direction","key","primaryKey","value"]),r(a,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(a.prototype[e]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,o),t(n._request).then(function(e){if(e)return new a(e,n._request)})})})}),u.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},o(u,"_store",["name","keyPath","indexNames","autoIncrement"]),r(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(u,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},o(d,"_tx",["objectStoreNames","mode"]),i(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},o(f,"_db",["name","version","objectStoreNames"]),i(f,"_db",IDBDatabase,["deleteObjectStore","close"]),l.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},o(l,"_db",["name","version","objectStoreNames"]),i(l,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[u,c].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=function(e){return Array.prototype.slice.call(e)}(arguments),n=t[t.length-1],o=this._store||this._index,r=o[e].apply(o,t.slice(0,-1));r.onsuccess=function(){n(r.result)}})})}),[c,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var p={open:function(e,t,o){var r=n(indexedDB,"open",[e,t]),i=r.request;return i&&(i.onupgradeneeded=function(e){o&&o(new f(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new l(e)})},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=p,e.exports.default=e.exports}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);var r;n(0),function(e){const t="TimeGhost",n={IndexedDbManager:new o.IndexedDbManager};e.initialise=function(){"undefined"==typeof window||window[t]?window[t]=Object.assign({},window[t],n):window[t]=Object.assign({},n)}}(r||(r={})),r.initialise()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.IndexedDbManager=class{constructor(){this.assemblyName="Blazor.IndexedDB",this.promiseCallback="PromiseCallback",this.promiseError="PromiseError",this.runFunction=((e,t,n)=>(console.log("Start runFunction"),this[t](n).then(t=>{void 0===t&&(t="");const n=JSON.stringify(t);DotNet.invokeMethodAsync(this.assemblyName,this.promiseCallback,e,n)}).catch(t=>{const n=JSON.stringify(t);DotNet.invokeMethodAsync(this.assemblyName,this.promiseError,e,n)}),!0)),this.isOpen=!1,this.db=new Promise((e,t)=>{}),this.openDb=(e=>{var t=e;return new Promise((e,n)=>{this.db=o.default.open(t.dbName,t.version,e=>{this.upgradeDatabase(e,t)}),e("database created")})}),this.addRecord=(e=>new Promise((t,n)=>{const o=e.storename,r=e.data;this.db.then(e=>{e.transaction(o,"readwrite").objectStore(o).add(r).then(e=>{t(`Add new recorded with id ${e}`)}).catch(e=>{console.error(e),n("Failed to add new record")})})})),this.getRecords=(e=>new Promise((t,n)=>{this.db.then(t=>t.transaction(e).objectStore(e).getAll()).then(e=>{var n=JSON.stringify(e);t(n)}).catch(e=>{console.error("Issue getting all records",e),n("failed to get records")})})),this.getRecordById=(e=>new Promise((t,n)=>{const o=e.storename,r=e.data;this.db.then(e=>e.transaction(o,"readonly").objectStore(o).get(r)).then(e=>{var n=JSON.stringify(e);t(n)}).catch(e=>{console.error(`failed to get record: ${r}`,e),n(`failed to get record: ${r}`)})}))}upgradeDatabase(e,t){if(e.oldVersion<t.version&&t.stores)for(let n=0;n<t.stores.length;n++){const o=t.stores[n];if(!e.objectStoreNames.contains(o.name)){let t=o.primaryKey;t||(t={name:"id",keyPath:"id",auto:!0});const n=e.createObjectStore(o.name,{keyPath:t.name,autoIncrement:t.auto});for(let e=0;e<o.indexes.length;e++){const t=o.indexes[e];n.createIndex(t.name,t.keyPath,{unique:t.unique})}}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2lkYi9saWIvaWRiLmpzIiwid2VicGFjazovLy8uL3NyYy9Jbml0aWFsaXNlSW5kZXhEYkJsYXpvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXhlZERiQmxhem9yLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwidGhpcyIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJDdXJzb3IiLCJwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCIsIkluZGV4IiwiaW5kZXgiLCJfaW5kZXgiLCJjdXJzb3IiLCJfY3Vyc29yIiwiX3JlcXVlc3QiLCJPYmplY3RTdG9yZSIsInN0b3JlIiwiX3N0b3JlIiwiVHJhbnNhY3Rpb24iLCJpZGJUcmFuc2FjdGlvbiIsIl90eCIsImNvbXBsZXRlIiwib25jb21wbGV0ZSIsIm9uYWJvcnQiLCJVcGdyYWRlREIiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsIkRCIiwiSURCSW5kZXgiLCJJREJDdXJzb3IiLCJtZXRob2ROYW1lIiwiY3JlYXRlSW5kZXgiLCJJREJPYmplY3RTdG9yZSIsIm9iamVjdFN0b3JlIiwiSURCVHJhbnNhY3Rpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsIklEQkRhdGFiYXNlIiwiZnVuY05hbWUiLCJyZXBsYWNlIiwiYXJyIiwiQXJyYXkiLCJzbGljZSIsInRvQXJyYXkiLCJjYWxsYmFjayIsImxlbmd0aCIsIm5hdGl2ZU9iamVjdCIsImdldEFsbCIsInF1ZXJ5IiwiY291bnQiLCJpbnN0YW5jZSIsIml0ZW1zIiwiaXRlcmF0ZUN1cnNvciIsInB1c2giLCJ1bmRlZmluZWQiLCJjb250aW51ZSIsImV4cCIsIm9wZW4iLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJkZWZhdWx0IiwiaW5kZXhlZERiQmxhem9yXzEiLCJJbmRleERiIiwidGltZWdob3N0RXh0ZW5zaW9ucyIsImV4dGVuc2lvbk9iamVjdCIsIkluZGV4ZWREYk1hbmFnZXIiLCJpbml0aWFsaXNlIiwid2luZG93IiwiYXNzaWduIiwiaWRiXzEiLCJbb2JqZWN0IE9iamVjdF0iLCJhc3NlbWJseU5hbWUiLCJwcm9taXNlQ2FsbGJhY2siLCJwcm9taXNlRXJyb3IiLCJydW5GdW5jdGlvbiIsImNhbGxiYWNrSWQiLCJmbk5hbWUiLCJkYXRhIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJEb3ROZXQiLCJpbnZva2VNZXRob2RBc3luYyIsImNhdGNoIiwicmVhc29uIiwiaXNPcGVuIiwib3BlbkRiIiwiZGJTdG9yZSIsImRiTmFtZSIsInVwZ3JhZGVEQiIsInVwZ3JhZGVEYXRhYmFzZSIsImFkZFJlY29yZCIsInJlY29yZCIsInN0TmFtZSIsInN0b3JlbmFtZSIsIml0ZW1Ub1NhdmUiLCJkYkluc3RhbmNlIiwiYWRkIiwiZ2V0UmVjb3JkcyIsInN0b3JlTmFtZSIsImpzb24iLCJnZXRSZWNvcmRCeUlkIiwiaWQiLCJzdG9yZXMiLCJzdG9yZVNjaGVtYSIsIm9iamVjdFN0b3JlTmFtZXMiLCJjb250YWlucyIsInByaW1hcnlLZXkiLCJrZXlQYXRoIiwiYXV0byIsImF1dG9JbmNyZW1lbnQiLCJqIiwiaW5kZXhlcyIsInVuaXF1ZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxhQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNB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LGNBQWVILEVBQVdFLE9BQ2xILElBQUssSUFBSUUsRUFBSSxFQUFHQSxFQUFJUCxFQUFZUSxRQUFReEUsT0FBUXVFLElBQUssQ0FDakQsTUFBTTNHLEVBQVFvRyxFQUFZUSxRQUFRRCxHQUNsQ3JHLEVBQU1pQixZQUFZdkIsRUFBTXpELEtBQU15RCxFQUFNd0csU0FBV0ssT0FBUTdHLEVBQU02RyIsImZpbGUiOiJpbmRleGVkRGIuQmxhem9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cbiAgICAgIGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cbiAgZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0oKSk7XG4iLCJpbXBvcnQgeyBJbmRleGVkRGJNYW5hZ2VyIH0gZnJvbSAnLi9pbmRleGVkRGJCbGF6b3InO1xyXG5pbXBvcnQgJ2lkYic7XHJcblxyXG5uYW1lc3BhY2UgSW5kZXhEYiB7XHJcbiAgICBjb25zdCB0aW1lZ2hvc3RFeHRlbnNpb25zOiBzdHJpbmcgPSAnVGltZUdob3N0JztcclxuICAgIGNvbnN0IGV4dGVuc2lvbk9iamVjdCA9IHtcclxuICAgICAgICBJbmRleGVkRGJNYW5hZ2VyOiBuZXcgSW5kZXhlZERiTWFuYWdlcigpXHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXNlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiAhd2luZG93W3RpbWVnaG9zdEV4dGVuc2lvbnNdKSB7XHJcbiAgICAgICAgICAgIHdpbmRvd1t0aW1lZ2hvc3RFeHRlbnNpb25zXSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLmV4dGVuc2lvbk9iamVjdFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHdpbmRvd1t0aW1lZ2hvc3RFeHRlbnNpb25zXSA9IHtcclxuICAgICAgICAgICAgICAgIC4uLndpbmRvd1t0aW1lZ2hvc3RFeHRlbnNpb25zXSxcclxuICAgICAgICAgICAgICAgIC4uLmV4dGVuc2lvbk9iamVjdFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbkluZGV4RGIuaW5pdGlhbGlzZSgpOyIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJNaWNyb3NvZnQuSlNJbnRlcm9wLmQudHNcIi8+XHJcbmltcG9ydCBpZGIgZnJvbSAnaWRiJztcclxuaW1wb3J0IHsgREIsIFVwZ3JhZGVEQiB9IGZyb20gJ2lkYic7XHJcblxyXG5cclxuaW50ZXJmYWNlIElTaW5nbGVSZWNvcmQge1xyXG4gICAgc3RvcmVuYW1lOiBzdHJpbmc7XHJcbiAgICBkYXRhOiBvYmplY3Q7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJSW5kZXhTcGVjIHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGtleVBhdGg6IHN0cmluZztcclxuICAgIHVuaXF1ZT86IGJvb2xlYW47XHJcbiAgICBhdXRvOiBib29sZWFuO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSVN0b3JlU2NoZW1hIHtcclxuICAgIGRiVmVyc2lvbj86IG51bWJlcjtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHByaW1hcnlLZXk6IElJbmRleFNwZWM7XHJcbiAgICBpbmRleGVzOiBJSW5kZXhTcGVjW107XHJcbn1cclxuXHJcbmludGVyZmFjZSBJRGJTdG9yZSB7XHJcbiAgICBkYk5hbWU6IHN0cmluZztcclxuICAgIHZlcnNpb246IG51bWJlcjtcclxuICAgIHN0b3JlczogSVN0b3JlU2NoZW1hW107XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSW5kZXhlZERiTWFuYWdlciB7XHJcbiAgICBwcml2YXRlIGFzc2VtYmx5TmFtZSA9ICdCbGF6b3IuSW5kZXhlZERCJztcclxuICAgIHByaXZhdGUgcHJvbWlzZUNhbGxiYWNrID0gJ1Byb21pc2VDYWxsYmFjayc7XHJcbiAgICBwcml2YXRlIHByb21pc2VFcnJvciA9ICdQcm9taXNlRXJyb3InOyBwdWJsaWMgcnVuRnVuY3Rpb24gPSAoY2FsbGJhY2tJZDogc3RyaW5nLCBmbk5hbWU6IHN0cmluZywgZGF0YTogYW55KTogYm9vbGVhbiA9PiB7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdTdGFydCBydW5GdW5jdGlvbicpO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpc1tmbk5hbWVdKGRhdGEpO1xyXG5cclxuICAgICAgICBwcm9taXNlLnRoZW4odmFsdWUgPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIERvdE5ldC5pbnZva2VNZXRob2RBc3luYyh0aGlzLmFzc2VtYmx5TmFtZSwgdGhpcy5wcm9taXNlQ2FsbGJhY2ssIGNhbGxiYWNrSWQsIHJlc3VsdCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKHJlYXNvbiA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnN0cmluZ2lmeShyZWFzb24pO1xyXG4gICAgICAgICAgICAgICAgRG90TmV0Lmludm9rZU1ldGhvZEFzeW5jKHRoaXMuYXNzZW1ibHlOYW1lLCB0aGlzLnByb21pc2VFcnJvciwgY2FsbGJhY2tJZCwgcmVzdWx0KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBpc09wZW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgZGI6IFByb21pc2U8REI+ID0gbmV3IFByb21pc2U8REI+KChyZXNvbHZlLCByZWplY3QpID0+IHsgfSk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvcGVuRGIgPSAoZGF0YSk6IFByb21pc2U8c3RyaW5nPiA9PiB7XHJcbiAgICAgICAgdmFyIGRiU3RvcmUgPSBkYXRhIGFzIElEYlN0b3JlO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5kYiA9IGlkYi5vcGVuKGRiU3RvcmUuZGJOYW1lLCBkYlN0b3JlLnZlcnNpb24sIHVwZ3JhZGVEQiA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZ3JhZGVEYXRhYmFzZSh1cGdyYWRlREIsIGRiU3RvcmUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoJ2RhdGFiYXNlIGNyZWF0ZWQnKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkUmVjb3JkID0gKHJlY29yZDogSVNpbmdsZVJlY29yZCk6IFByb21pc2U8c3RyaW5nPiA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdE5hbWUgPSByZWNvcmQuc3RvcmVuYW1lO1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtVG9TYXZlID0gcmVjb3JkLmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuZGIudGhlbihkYkluc3RhbmNlID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHR4ID0gZGJJbnN0YW5jZS50cmFuc2FjdGlvbihzdE5hbWUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgICAgICAgIHR4Lm9iamVjdFN0b3JlKHN0TmFtZSkuYWRkKGl0ZW1Ub1NhdmUpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4odmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGBBZGQgbmV3IHJlY29yZGVkIHdpdGggaWQgJHt2YWx1ZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ0ZhaWxlZCB0byBhZGQgbmV3IHJlY29yZCcpXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZWNvcmRzID0gKHN0b3JlTmFtZTogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZGIudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZShzdG9yZU5hbWUpLmdldEFsbCgpO1xyXG4gICAgICAgICAgICB9KS50aGVuKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGpzb24pO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiSXNzdWUgZ2V0dGluZyBhbGwgcmVjb3Jkc1wiLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoXCJmYWlsZWQgdG8gZ2V0IHJlY29yZHNcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZWNvcmRCeUlkID0gKGRhdGE6IElTaW5nbGVSZWNvcmQpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc3RvcmVOYW1lID0gZGF0YS5zdG9yZW5hbWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLmRiLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgXCJyZWFkb25seVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZShzdG9yZU5hbWUpLmdldChpZCk7XHJcbiAgICAgICAgICAgIH0pLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBqc29uID0gSlNPTi5zdHJpbmdpZnkocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoanNvbik7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYGZhaWxlZCB0byBnZXQgcmVjb3JkOiAke2lkfWAsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChgZmFpbGVkIHRvIGdldCByZWNvcmQ6ICR7aWR9YCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBncmFkZURhdGFiYXNlKHVwZ3JhZGVEQjogVXBncmFkZURCLCBkYlN0b3JlOiBJRGJTdG9yZSkge1xyXG4gICAgICAgIGlmICh1cGdyYWRlREIub2xkVmVyc2lvbiA8IGRiU3RvcmUudmVyc2lvbikge1xyXG4gICAgICAgICAgICBpZiAoZGJTdG9yZS5zdG9yZXMpIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGJTdG9yZS5zdG9yZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9yZVNjaGVtYSA9IGRiU3RvcmUuc3RvcmVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdXBncmFkZURCLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoc3RvcmVTY2hlbWEubmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByaW1hcnlLZXkgPSBzdG9yZVNjaGVtYS5wcmltYXJ5S2V5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByaW1hcnlLZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlLZXkgPSB7IG5hbWU6ICdpZCcsIGtleVBhdGg6ICdpZCcsIGF1dG86IHRydWUgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZVNjaGVtYS5uYW1lLCB7IGtleVBhdGg6IHByaW1hcnlLZXkubmFtZSwgYXV0b0luY3JlbWVudDogcHJpbWFyeUtleS5hdXRvIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHN0b3JlU2NoZW1hLmluZGV4ZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc3RvcmVTY2hlbWEuaW5kZXhlc1tqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KGluZGV4Lm5hbWUsIGluZGV4LmtleVBhdGgsIHsgdW5pcXVlOiBpbmRleC51bmlxdWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvL3B1YmxpYyBnZXRPYmplY3RTdG9yZSA9IChzdG9yZU5hbWU6IHN0cmluZywgbW9kZTogJ3JlYWRvbmx5JyB8ICdyZWFkd3JpdGUnIHwgJ3ZlcnNpb25jaGFuZ2UnIHwgdW5kZWZpbmVkKTogSURCT2JqZWN0U3RvcmUgPT4ge1xyXG4gICAgLy8gICAgY29uc3QgdHg6IElEQlRyYW5zYWN0aW9uID0gdGhpcy5kYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIG1vZGUpO1xyXG4gICAgLy8gICAgcmV0dXJuIHR4Lm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcbiAgICAvL31cclxuXHJcblxyXG5cclxufSJdLCJzb3VyY2VSb290IjoiIn0=